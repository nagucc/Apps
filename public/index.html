<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Concept@纳谷概念云</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../../Content/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    <script src="../../Content/bootstrap/js/assets/jquery-1.8.2.min.js" type="text/javascript"></script> 
</head>
<body>
    <div class="navbar">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="#">Concept@纳谷概念云</a>

            <span id="qqLoginBtn" ></span>

            <span class="btn-toolbar nagu-logged hide">
                <a class="btn btn-primary" onclick="createConceptDialog.toggle('', {h3:'创建新Concept'})">
                    <i class="icon-plus icon-white"></i>
                    创建新Concept
                </a>
            </span>
        </div>
      </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="span10 offset1">
                <div class="modal-header">
                    
                    <h3>搜索Concept</h3>
                    <span><i>输入关键字搜索想要的Concept</i></span>
                </div>
                <div class="modal-body">
                    <span class="form-horizontal">
                        <div class="control-group">
                            <label for="tbName" class="control-label">名称</label>
                            <div class="controls">
                                <input type="text" id="tbName" onkeypress="if(event.keyCode === 13){search();}" placeholder="输入关键字并搜索"/>
                                <button onclick="search();" class="btn">搜索</button>
                            </div>
                        </div>
                    </span>
                    <h4 class='hide'>搜索结果</h4>
                    <ul id="result" class="nav nav-pills"></ul>
                    <div id="localConcepts" class="hide">
                    最近访问：
                    <ul class="nav nav-pills"></ul>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer"> 
        <p class="pull-right"><a href="#">回到顶端</a></p>
        <p>本系统是由na57开发的测试系统，所有数据目前只作为测试使用。</p>
        <p>系统所有数据均存储于nagu.cc概念云系统中，所有数据通过RDF三元组的形式进行组织。</p>
      </footer>

        <script type="text/javascript">
            var createConceptDialog;
            $(document).ready(function () {
                Nagu.MM.check().done(function (status) {
                    if (status.nagu) {
                        afterNaguLogin();
                    }
                });

                QC.Login({
                    btnId: "qqLoginBtn",
                    scope: "all",
                    size: "A_M"
                }, afterQCLogin);

                var concepts = $.jStorage.get('concepts', []);
                if (concepts.length > 0) {
                    var div = $('#localConcepts').show();
                    var ul = div.find('ul');
                    ul.conceptList(concepts.reverse(), {
                        clearBefore: true,
                        pageSize: 10,
                        renderItem: function (concept, li) {
                            li.appendConcept(concept.ConceptId);
                            li.find('a').click(function () {
                                var conceptId = li.attr('ConceptId');
                                window.location = 'concept.html?id=' + conceptId;
                            });
                        }
                    });
                }
            });

            function afterNaguLogin() {
                $('.nagu-logged').show();
                createConceptDialog = new CreateConceptDialog();
            }

            // 当QQ登录成功之后：
            function afterQCLogin(reqData, opts) {
                QC.api("get_user_info").success(function (s) {
                    var span = $("#qqLoginBtn");
                    var spanF = newSpan().append(newImg(s.data.figureurl));
                    var spanN = newSpan().text(s.data.nickname);
                    var spanL = newSpan().append(newA("#").text("退出").click(function () { QQLogout(); }));

                    span.empty();
                    span.append(spanF).append(spanN).append(spanL);
                });

                Nagu.MM.getMe().fail(function () {
                    // 使用当前QC的凭据登录nagu
                    QC.Login.getMe(function (openId, accessToken) {
                        Nagu.MM.loginFromQC(openId, accessToken).done(function (data) {
                            if (data.Status == "OK") {
                                afterNaguLogin();
                            }
                        });
                    });
                });
            }

          function search() {
              $('h4').show();
              var tempLi = newLi().append(newImg('/Content/Images/loading-128.gif'));
              $('#result').empty().append(tempLi);
              Nagu.CM.search($('#tbName').val()).done(function (cs) {
                  if (cs.length == 0) {
                      $('#result').empty().append(newLi().append('没有找到任何数据'));
                      return;
                  }
                  $('#result').conceptList(cs, {
                      clearBefore: true,
                      pageSize: 5,
                      renderItem: function (concept, li) {
                          li.appendConcept(concept.ConceptId);
                          li.find('a').click(function () {
                              var conceptId = li.attr('ConceptId');
                              var concepts = $.jStorage.get('concepts', []);
                              var localcs = $.grep(concepts, function (c, i) {
                                  return c.ConceptId == conceptId;
                              });
                              if (localcs.length == 0) {
                                  Nagu.CM.get(conceptId).done(function (c) {
                                      concepts.push(c);
                                  });
                              }
                              $.jStorage.set('concepts', concepts);

                              window.location = 'concept.html?id=' + conceptId;
                          });
                      }
                  });
              });
          }
        </script>
    </div>


















    
    <script src="../../Content/bootstrap/js/bootstrap.js" type="text/javascript"></script>
    <script src="../../Content/bootstrap/js/assets/bootstrap-button.js" type="text/javascript"></script>
    <script src="../../Content/bootstrap/js/assets/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="../../Content/bootstrap/js/assets/bootstrap-modal.js" type="text/javascript"></script>
    <script src="../../Content/bootstrap/js/assets/bootstrap-transition.js" type="text/javascript"></script>

    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="../../Content/js/jquery.qrcode.min.js" type="text/javascript"></script>

    <script src="../../Content/js/js-helper.js" type="text/javascript"></script>
    <script src="../../Content/js/jquery-helper.js" type="text/javascript"></script>
    <script src="../../Content/js/bootstrap-helper.js" type="text/javascript"></script>
    <script src="../../Content/js/nagu-helper.js" type="text/javascript"></script>
    <script src="../../Content/js/apps-helper.js" type="text/javascript"></script>
    <script src="../../Content/js/bootstarp-dropdownmenu.js" type="text/javascript"></script>
    <script src="../../Content/js/nagu-bs-accordion.js" type="text/javascript"></script>

    <script src="../../Content/js/jquery/fileupload/vendor/jquery.ui.widget.js" type="text/javascript"></script>
    <script src="../../Content/js/jquery/fileupload/jquery.fileupload.js" type="text/javascript"></script>
    <script src="../../Content/js/jquery/fileupload/jquery.iframe-transport.js" type="text/javascript"></script>

    <script type="text/javascript" src="http://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js" data-appid="100321920"  charset="utf-8"></script>
    <script src="../../Content/lib/jStorage/jstorage.min.js" type="text/javascript"></script>
</body>
</html>