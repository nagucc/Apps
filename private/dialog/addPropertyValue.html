<div class="modal hide" id="{dlgAddPropertyValue}">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>标题</h3>
    </div>
    <div class="modal-body">
        <div class="hide alert alert-error">
            <strong>出错啦！</strong>
            <ul class="error-list">
            </ul>
        </div>


        <div class="accordion" id="accordion2">
            <div class="accordion-group">
                <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseConcept">
                    添加Concept作为属性值
                </a>
                </div>
                <div id="collapseConcept" class="accordion-body collapse" style="height: 0px;">
                    <div class="accordion-inner">
                        <label for="{txtFn}">Concept名称</label>
                        <input id="{txtFn}" type="text" class="span3" placeholder="请输入关键字后等待搜索..." />
                        <input id="{txtFn}_id" type="hidden" />
                    </div>
                </div>
            </div>

            <div class="accordion-group">
                <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseLiteral">
                    添加文本作为属性值
                </a>
                </div>
                <div id="collapseLiteral" class="accordion-body collapse" style="height: 0px;">
                <div class="accordion-inner">
                    <label for="{txtValue}">属性值</label>
                    <input id="{txtValue}" type="text" class="span3" placeholder="输入文本作为属性值..." />
                </div>
                </div>
            </div>

            <div class="accordion-group">
                <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseImage">
                    上传图片至第三方作为属性值(暂不可用)
                </a>
                </div>
                <div id="collapseImage" class="accordion-body collapse" style="height: 0px;">
                    <div class="accordion-inner">
                        <input id="txtImage" type="file" />
                    </div>
                </div>
            </div>

        </div>

        <label class="checkbox">
            <input type="checkbox" userId="" id='{cbOnlyMe}' disabled="disabled" /><i class="icon-lock" />仅我可见
        </label>
    </div>
    <div class="modal-footer">
        
        <a href="#" class="btn" data-dismiss="modal">取消</a>
        <button class="btn btn-primary" onclick="addPropertyValue34532532453245325();">确定</button>
    </div>
</div>

<script type="text/javascript">
    $("#{dlgAddPropertyValue}").modal({
        backdrop: false,
        keyboard: false,
        show: false
    });
    initConceptSearch($('#{txtFn}'), $('#{txtFn}_id'));

    // 获取当前用户信息,并激活"仅我可见"按钮.
    var mm = new MemberManager();
    mm.getMe().done(function (me) {
        $('#{cbOnlyMe}').removeAttr('disabled').attr('userId', me.Id);
    });
    

    function addPropertyValue34532532453245325() {
        var onPropertyValueAdded = null;
        var subject = $('#{dlgAddPropertyValue}').attr('subjectId');
        var stype = $('#{dlgAddPropertyValue}').attr('stype');
        var predicateId = $('#{dlgAddPropertyValue}').attr('predicateId');

        var appId = $('#{cbOnlyMe}').attr('checked') === undefined ? "" : $('#{cbOnlyMe}').attr('userId');

        var ulError = $("#{dlgAddPropertyValue} ul.error-list").empty();

        var cm = new ConceptManager();
        // 如果属性值是Concept：
        if ($('#collapseConcept').hasClass('in')) {
            var fn = $('#{txtFn}').val();
            var conceptId = $('#{txtFn}_id').val();
            if (fn == "") {
                ulError.append(newLi().append("请输入关键字并选择Concept"));
                $('#{dlgAddPropertyValue} .alert-error').show();
                return;
            }
            cm.addConceptPropertyValue(subject, stype, predicateId, fn, conceptId, { appId: appId }).done(function (fs) {
                $('#{txtFn}').val('');
                $('#{txtFn}_id').val('');
                $('#{dlgAddPropertyValue}').modal('hide');
                AddPropertyValueDialog.added(fs);
            });
        // 如果属性值是第三方上传图片:
        } else if ($('#collapseImage').hasClass('in')) {
            var mm = new MemberManager();
            mm.check().done(function (status) {
                // 如果QQ登录，则上传图片到腾讯微博
                if (status.qc) {
                    var reader = new FileReader();
                    reader.onload = function (oFREvent) {
                        QC.api("add_pic_t", {
                            content: 'image from nagucc localhost',
                            pic: oFREvent.target.result
                        }).success(function (s) {
                            alert(s.data.imgurl);
                        });
                    };
                    var name = $('#txtImage')[0].files[0];
                    reader.readAsBinaryString(name);
                }
            });
        } else  { // 属性值是文本：
            var val = $('#{txtValue}').val();
            if (val == "") {
                ulError.append(newLi().append("请输入属性值"));
                $('#{dlgAddPropertyValue} .alert-error').show();
                return;
            }
            cm.addLiteralPropertyValue(subject, predicateId, val, { appId: appId }).done(function (fs) {
                $('#{txtValue}').val('');
                $('#{dlgAddPropertyValue}').modal('hide');
                AddPropertyValueDialog.added(fs);
            });
        }
    }
</script>